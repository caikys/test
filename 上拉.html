<!DOCTYPE html>
<html lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>上拉</title>
</head>
<link rel="stylesheet" type="text/css" href="css/reset.css">
<script src="js/jquery-1.8.3.min.js"></script>
<style type="text/css">
	#main{
		height: 1730px;
		background: #78f4f5;
		width: 100%;
		font-size: 30px;
		text-align: center;
		position: relative;
	}
	#main i{
		position: absolute;
		bottom: 0;
		left: 40%;
		font-size: 20px;
		color: red;
	}
	#detail{
		height: 1000px;
		background: #87f578;
		width: 100%;
		font-size: 30px;
		text-align: center;
	}
	.ki{
		width: 100%;
		height: 200px;
		line-height: 30px;
		background: #f3a035;
	}
</style>
<body>
	<div id="main">首页<i>首页底部</i></div>
	<div class="ki">下拉详情页</div>
	<div id="detail">详情页</div>
	<span>0</span>
</body>
<script type="text/javascript">
	$( function(){
		var $main=$('#main');
		var $ki=$('.ki');
		var x=0;

		//滚动条在Y轴上的滚动距离
		function getScrollTop() {
            //滚动条在Y轴上的滚动距离
            var scrollTop = 0, bodyScrollTop = 0, documentScrollTop = 0;
            if (document.body) {
                bodyScrollTop = document.body.scrollTop;
            }
            if (document.documentElement) {
                documentScrollTop = document.documentElement.scrollTop;
            }
            scrollTop = (bodyScrollTop - documentScrollTop > 0) ? bodyScrollTop : documentScrollTop;
            console.log('滚动条高度'+scrollTop);
            return scrollTop;
        }

        //浏览器视口的高度
        function getWindowHeight() {
            var windowHeight = 0;
            if (document.compatMode == "CSS1Compat") {
                windowHeight = document.documentElement.clientHeight;
            } else {
                windowHeight = document.body.clientHeight;
            }
            // console.log('浏览器可视区域高度'+windowHeight)
            return windowHeight;
        }

        //文档的总高度
        function getScrollHeight() {
            var scrollHeight = 0, bodyScrollHeight = 0, documentScrollHeight = 0;
            if (document.body) {
                bodyScrollHeight = document.body.scrollHeight;
            }
            if (document.documentElement) {
                documentScrollHeight = document.documentElement.scrollHeight;
            }
            scrollHeight = (bodyScrollHeight - documentScrollHeight > 0) ? bodyScrollHeight : documentScrollHeight;
            // console.log('文档的总高度'+scrollHeight)
            return scrollHeight;
        }

		// 监听滚动事件
        $(window).on("touchend", function(){
        	// 元素总高度 不包括border padding margin
        	// console.log('高度1:'+$aa.height());
        	// 元素总高度 包括border padding margin
        	// console.log('主高度:'+$main.outerHeight());
        	// console.log('过度高度：'+$tip.outerHeight())
        	// console.log('浏览器滚动条的高度'+$(document).scrollTop());
        	// console.log('窗口可是区域的高度：'+$(window).height());
			// var i=$(document).scrollTop()+$(window).height()-9;
			// console.log('滚动条的高度加可视区域的高度'+i);
			// getScrollTop();
			// getWindowHeight();
			// getScrollHeight();
			$("span").text(x+=1);
			var scrollHeight=$main.outerHeight();
        	var transitHeight=$ki.outerHeight();
        	var windowHeight=getWindowHeight();
			var ScrollTop=getScrollTop();
			function xia(){
				var a=scrollHeight-windowHeight;
				var b=scrollHeight-windowHeight+(transitHeight/2);
				var g=scrollHeight+transitHeight;
				console.log('a大于'+a);
				console.log('b小于'+b);
				console.log('上页面跳转目标'+g);
				if(a<ScrollTop&&ScrollTop<b){
                    $("html,body").animate({scrollTop:g},500);
                };
			}
			function shang(){
				var i=scrollHeight+(transitHeight/2);
				var j=scrollHeight+transitHeight;
				var g=scrollHeight-windowHeight;
				console.log('i大于'+i);
				console.log('j小于'+j);
				console.log('下页面跳转目标'+g);
                if(i<ScrollTop&&ScrollTop<j){
                    $("html,body").animate({scrollTop:g},500)
                }
            }
			xia();
			// shang();

			// //保存1
			// function pullDown(){
   //              if(scrollHeight-getWindowHeight()-10<getScrollTop()&&getScrollTop()<scrollHeight-getWindowHeight()){
   //                  $("html,body").animate({scrollTop:scrollHeight-100},1000);
   //              };
   //          }
   //          function pullUp(){
   //              if(scrollHeight-120<getScrollTop()&&getScrollTop()<scrollHeight-100){
   //                  $("html,body").animate({scrollTop:scrollHeight-getWindowHeight()-30},1000)
   //              }
   //          }


   //          //保存2
   //          // 监听滚动事件
	  //       $(window).on("scroll", function(){
	  //           console.log('主高度:'+$product_container.outerHeight());
	  //           console.log('过度高度：'+$ki.outerHeight())
	  //           var scrollHeight=$product_container.outerHeight()+$ki.outerHeight();
	  //           console.log('总高度'+scrollHeight);
	  //           getScrollTop();
	  //           getWindowHeight();
	  //           function pullDown(){
	  //               if(getScrollTop()==scrollHeight-getWindowHeight()){
	  //                   $("html,body").animate({scrollTop:scrollHeight-100},1000);
	  //               };
	  //           }
	  //           function pullUp(){
	  //               if(getScrollTop()==scrollHeight-115){
	  //                   $("html,body").animate({scrollTop:scrollHeight-getWindowHeight()-30},1000)
	  //               }
	  //           }
	  //           pullDown();
	  //           pullUp();
	            
	  //       });
			
		});
	})
</script>
</html>